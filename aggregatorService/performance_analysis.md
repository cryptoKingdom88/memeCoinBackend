# Processing Time Analysis

## 관찰된 현상
- 일부 배치: 713µs (매우 빠름)
- 일부 배치: 1초 이상 (매우 느림)

## 처리 시간 차이의 주요 원인들

### 1. **토큰 프로세서 초기화 지연**
```
첫 번째 거래 → 새 토큰 프로세서 생성 → Redis에서 기존 데이터 로드 → 초기화
후속 거래 → 기존 프로세서 사용 → 빠른 처리
```

### 2. **Redis 연결 상태**
```
Redis 연결 풀 사용 가능 → 빠른 처리 (713µs)
Redis 연결 풀 고갈/재연결 → 느린 처리 (1초+)
```

### 3. **Worker Pool 대기**
```
Worker 즉시 사용 가능 → 빠른 처리
Worker Pool 포화 상태 → 대기 시간 발생 → 느린 처리
```

### 4. **슬라이딩 윈도우 계산 복잡도**
```
적은 기존 거래 → 빠른 계산
많은 기존 거래 + 만료 처리 → 복잡한 계산 → 느린 처리
```

### 5. **GC (Garbage Collection) 영향**
```
GC 미발생 → 빠른 처리
GC 발생 중 → 일시 정지 → 느린 처리
```

## 성능 병목 지점 분석

### 주요 병목 지점:
1. **토큰 프로세서 생성** (첫 거래 시)
2. **Redis I/O 대기**
3. **Worker Pool 경합**
4. **메모리 할당/해제**
5. **슬라이딩 윈도우 만료 계산**